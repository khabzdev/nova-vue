import{i as C}from"./nullish-CHIgUVhi.js";import{u as B}from"./useForwardExpose-ClhNePUc.js";import{P as _}from"./Primitive-B5VkAsKh.js";import{h as g}from"./handleAndDispatchCustomEvent-ChOKVcqp.js";import{y as w,t as E,n as h,r as P,d as T,C as F,D as S,E as x,G as W,f as p,R as k,c as D,v as I}from"./vue.esm-bundler-BitZzlT5.js";import{a as L}from"./index-CvzWs3kq.js";import{o as A}from"./index-BGV6KQZa.js";const R="dismissableLayer.pointerDownOutside",q="dismissableLayer.focusOutside";function b(o,s){const r=s.closest("[data-dismissable-layer]"),t=o.dataset.dismissableLayer===""?o:o.querySelector("[data-dismissable-layer]"),a=Array.from(o.ownerDocument.querySelectorAll("[data-dismissable-layer]"));return!!(r&&(t===r||a.indexOf(t)<a.indexOf(r)))}function z(o,s,r=!0){var c;const t=((c=s==null?void 0:s.value)==null?void 0:c.ownerDocument)??(globalThis==null?void 0:globalThis.document),a=P(!1),i=P(()=>{});return w(u=>{if(!L||!E(r))return;const l=async v=>{const m=v.target;if(!(!(s!=null&&s.value)||!m)){if(b(s.value,m)){a.value=!1;return}if(v.target&&!a.value){let e=function(){g(R,o,O)};const O={originalEvent:v};v.pointerType==="touch"?(t.removeEventListener("click",i.value),i.value=e,t.addEventListener("click",i.value,{once:!0})):e()}else t.removeEventListener("click",i.value);a.value=!1}},f=window.setTimeout(()=>{t.addEventListener("pointerdown",l)},0);u(()=>{window.clearTimeout(f),t.removeEventListener("pointerdown",l),t.removeEventListener("click",i.value)})}),{onPointerDownCapture:()=>{E(r)&&(a.value=!0)}}}function K(o,s,r=!0){var i;const t=((i=s==null?void 0:s.value)==null?void 0:i.ownerDocument)??(globalThis==null?void 0:globalThis.document),a=P(!1);return w(c=>{if(!L||!E(r))return;const u=async l=>{if(!(s!=null&&s.value))return;await h(),await h();const f=l.target;!s.value||!f||b(s.value,f)||l.target&&!a.value&&g(q,o,{originalEvent:l})};t.addEventListener("focusin",u),c(()=>t.removeEventListener("focusin",u))}),{onFocusCapture:()=>{E(r)&&(a.value=!0)},onBlurCapture:()=>{E(r)&&(a.value=!1)}}}const n=I({layersRoot:new Set,layersWithOutsidePointerEventsDisabled:new Set,originalBodyPointerEvents:void 0,branches:new Set});var N=T({__name:"DismissableLayer",props:{disableOutsidePointerEvents:{type:Boolean,required:!1,default:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},emits:["escapeKeyDown","pointerDownOutside","focusOutside","interactOutside","dismiss"],setup(o,{emit:s}){const r=o,t=s,{forwardRef:a,currentElement:i}=B(),c=D(()=>{var e;return((e=i.value)==null?void 0:e.ownerDocument)??globalThis.document}),u=D(()=>n.layersRoot),l=D(()=>i.value?Array.from(u.value).indexOf(i.value):-1),f=D(()=>n.layersWithOutsidePointerEventsDisabled.size>0),v=D(()=>{const e=Array.from(u.value),[y]=[...n.layersWithOutsidePointerEventsDisabled].slice(-1),d=e.indexOf(y);return l.value>=d}),m=z(async e=>{const y=[...n.branches].some(d=>d==null?void 0:d.contains(e.target));!v.value||y||(t("pointerDownOutside",e),t("interactOutside",e),await h(),e.defaultPrevented||t("dismiss"))},i),O=K(e=>{[...n.branches].some(d=>d==null?void 0:d.contains(e.target))||(t("focusOutside",e),t("interactOutside",e),e.defaultPrevented||t("dismiss"))},i);return A("Escape",e=>{l.value===u.value.size-1&&(t("escapeKeyDown",e),e.defaultPrevented||t("dismiss"))}),w(e=>{i.value&&(r.disableOutsidePointerEvents&&(n.layersWithOutsidePointerEventsDisabled.size===0&&(n.originalBodyPointerEvents=c.value.body.style.pointerEvents,c.value.body.style.pointerEvents="none"),n.layersWithOutsidePointerEventsDisabled.add(i.value)),u.value.add(i.value),e(()=>{r.disableOutsidePointerEvents&&n.layersWithOutsidePointerEventsDisabled.size===1&&!C(n.originalBodyPointerEvents)&&(c.value.body.style.pointerEvents=n.originalBodyPointerEvents)}))}),w(e=>{e(()=>{i.value&&(u.value.delete(i.value),n.layersWithOutsidePointerEventsDisabled.delete(i.value))})}),(e,y)=>(F(),S(p(_),{ref:p(a),"as-child":e.asChild,as:e.as,"data-dismissable-layer":"",style:k({pointerEvents:f.value?v.value?"auto":"none":void 0}),onFocusCapture:p(O).onFocusCapture,onBlurCapture:p(O).onBlurCapture,onPointerdownCapture:p(m).onPointerDownCapture},{default:x(()=>[W(e.$slots,"default")]),_:3},8,["as-child","as","style","onFocusCapture","onBlurCapture","onPointerdownCapture"]))}}),J=N;export{J as D,n as c};
